# 入职时间
#### 2019年5月7号

## 第一周（5.7 - 5.11）
* 确定工作方向
* 学习python
* 了解python版本项目结构
* 两个小任务
  * 服务器端写一个全服广播功能模块
  * 客户端接入Unity Cloud Diagnostics
### 全服广播模块
* 一开始采用python中的pyee库来写，打算使用事件监听的方式进行广播
* 后听取了导师的指导，开发了全服广播基本功能
  * 根据广播文本进行广播播报
  * 根据广播id进行广播播报 
* 根据广播id进行广播的具体思路为：
  * 向配置表中加入广播标准文本，文本中有相应的通配符，每个文本有自己的id
  * 通过广播id得到广播标准文本，扫描字符串，进行通配符的替换
  * 将替换后的文本进行全服广播
* 全服广播实现方式即为：
  * 扫描字符串
  * 通配符替换
  * 通过事件监听器进行广播 

## 第二周（5.14 - 5.18）
* 完善广播功能模块
* 学习git基本流程（创建分支——转换分支——在分支上进行开发——commit——push），尝试将python版本的全服广播模块push到分支
* 尝试接入Unity Cloud Diagnostics，并编写了相关文档

## 第三周（5.21 - 5.25）
* 学习gs语言（数据类型、条件语句等）
* 尝试移植广播功能模块到gs版本
* 学习了敏感词屏蔽算法（前缀树）
* 了解gs版本项目结构

## 第四周（5.28 - 6.1）
* 完成gs版本广播功能模块的移植
* 向gs版本增加离线收益报告功能
  * 离线收益报告：
    * 离线收益总体报告
    * 秘境挂机详细报告
  * 具体实现其实是游戏逻辑的判断
  * 玩家离线存在两种状态：修炼、秘境两种挂机状态
  * 玩家若是修炼挂机状态退出的游戏，在其退出十分钟后会调用服务器登出玩家的方法将其角色真正的登出（避免掉线情况的出现），修炼的挂机状态仅用记录下服务器登出玩家时间，后用玩家登陆时间-登出时间这段时间来计算离线收益即可
  * 秘境挂机状态则需要考虑秘境挂机最大时间为8小时，故在玩家角色的心跳方法中进行判断：
    * 角色是离线状态
    * 角色挂机时间是否超过八个钟
  * 若是超过了八个钟即转变玩家挂机状态（改为修炼挂机），同时调用服务器登出玩家操作同时记录下登出时间，待玩家上线后实际离线收益为秘境挂机收益加上修炼挂机收益
    * 秘境挂机收益即为玩家登出时间-玩家退出游戏时间的收益
    * 修炼挂机收益即为玩家登陆时间-玩家登出时间的收益
  * 具体实现过程为，在玩家登陆的时候在相应的登陆回调方法中进行状态的判断计算相应的离线收益（离线超过十分钟（此时才有登出时间的记录）才显示离线收益报告），服务器登出玩家的时候进行报告数据的清零，报告数据的记录即在相应的操作下进行数据库的写入。

## 第五周（6.4 - 6.6）
* 修复一些提示相关的小问题
  *  涉及到了命令的处理
  *  项目中存在三个终端：客户端、主服务器、辅助服务器
  *  主服务器负责处理游戏的主要逻辑
  *  辅助服务器则是处理玩家社交、全服广播等功能
  *  主服务器上有一个MsgHandler管理器负责对命令的处理
  *  先将编写好的方法绑定到相应的命令上，再将命令集保存在handlers的一个map中，后对map中的命令进行注册，当服务器收到来自客户端或者辅助服务器的请求的时候就会调用相应的方法
* 移植GM功能模块
  * 其中有一个GM功能是定时关机
  * 在这里面服务器关机方法是一个同步的方法，因为关机的过程不同的模块之间存在依赖，便直接把先后顺序写在这个方法中
  * 同样的为了避免误操作，服务器关机方法有一个cookie进行是否执行方法的的验证
  * 调用服务器关机方法需要新开一个协程，在协程中进行服务器关机，因为服务器关机中会将服务器正在关机的标志位置为true，而为了确保关机的flag在各个协程中一致，便简单的进行了协程休眠0.1秒的处理

## 第六周（6.11 - 6.15）
* 负责python版本版号申请的相关修改
  * 文本修改 —— BOSS->首领
  * 增加PVP警告
    * 具体实现方法是玩家角色到达15级时将"show_pvp_warning"的标志位为true，然后玩家在进入秘境的时候会向数据库读这一标志位的值，如果是true就显示PVP警告，当玩家点击接受按钮后客户端向服务端发接受信息并将"show_pvp_warning"置为false
  * 商店页面增加充值按钮
  * 隐藏帮助按钮等等

* 负责回归测试相关问题的修复
  * 登录界面玩家停留超过一定时间就自动断开连接
    * 实际上是创建了ws后ws超过了一段时间没有对象绑定它就进行销毁操作，修改超时时间即可
  * 排行榜页面显示战力和查看玩家信息里页面的战力不一致
    * 由于排行榜信息是存于redis中的，redis相当于缓存，每隔60s进行数据的保存，故会存在战力不一致的情况
  * 人物战力 = 装备附加战力 + 技能附加战力 + 自身气血 + 自身真元的修复
    * 其中后两项的战力策划要求当玩家进入人物属性界面的时候进行一次战力的刷新
    * 解决方案是当客户端玩家点击了人物属性界面按钮时同时向服务端发送刷新战力的请求，服务器返回刷新后的战力

## 第七周（6.17 - 6.20）
* 跑通压力测试并出性能报告
  * 测试在500人/1000人/2000人/5000人的情况下,内存/CPU/延迟等数据的情况
    * 完善了压测客户端的代码逻辑，在py版本下内存/cpu的获取是通过python的psutil库来获取的，在gs中暂时没有实现这一功能，故编写了一个外部的py程序来获取
    * 由于服务器端是gs版本而压测客户端是py语言写的，故如果要测试延迟的话，单纯的服务器->客户端或者客户端->服务端是行不通的，因为底层获取毫秒级时间的实现有所差异
    * 解决方法是 服务器->客户端->服务器 取这段时间除以2
  * 希望测试机器人可以配置为指定等级的标准人（有装备、技能） 
  * 希望可以配置机器人在不同秘境的分布情况

## 第八周（6.24 - 6.29）
* 换线表现问题
  * 选择线路后，combobox没有改变
    * 实际原因是点击线路后向服务器发送请求，服务器收到请求执行的指令的为玩家分配一条最优线路，故线路没有改变，修改下代码逻辑即可

* 增加怪物脱战回血机制和属性调节
  * 增加怪物脱战回血机制
    * 需求是脱离战斗后每秒回复2%的血量（在calc表中配置）
    * 初步思路是将脱战回血写在心跳中，当怪物是脱战状态且残血就进行自动回复
    * 但原本心跳的逻辑是周围没有玩家，怪物就停止心跳，这与上面逻辑产生冲突
    * 故改为当周围没有玩家且满状态时才停止心跳，脱战回血至满状态停止心跳
  * 支持单独配置某一怪物的属性比例
  * 支持快速调节秘境怪物难度

* 离线相关调整
  * 离线状态保存
    * 当玩家切出游戏小于等于60s，保留玩家之前操作的界面
    * 当玩家切出游戏大于60s，进行重新连接
    * 产生这一需求的原因是，当玩家切出游戏的时候，客户端判断玩家切出就执行断线操作，故玩家切回来游戏会重新连接，界面也重置到主界面
    * 解决方案为加入标志位和定时器

* 统一游戏内所有系统的重置时间至上午八点
  * 每次刷新商店物品记录时间，当记录的时间与当前时间不在同一天 或者 记录的时间的小时小于8（这是保证已经是下一个刷新周期了），就继续判断当前时间的小时有没有超过8小时，就执行相应的重置操作
