# 入职时间
#### 2019年5月7号

## 第一周（5.7 - 5.11）
* 确定工作方向
* 学习python
* 了解python版本项目结构
* 两个小任务
  * 服务器端写一个全服广播功能模块
  * 客户端接入Unity Cloud Diagnostics
### 全服广播模块
* 一开始采用python中的pyee库来写，打算使用事件监听的方式进行广播
* 后听取了导师的指导，开发了全服广播基本功能
  * 根据广播文本进行广播播报
  * 根据广播id进行广播播报 
* 根据广播id进行广播的具体思路为：
  * 向配置表中加入广播标准文本，文本中有相应的通配符，每个文本有自己的id
  * 通过广播id得到广播标准文本，扫描字符串，进行通配符的替换
  * 将替换后的文本进行全服广播
* 全服广播实现方式即为：
  * 扫描字符串
  * 通配符替换
  * 通过事件监听器进行广播 

## 第二周（5.14 - 5.18）
* 完善广播功能模块
* 学习git基本流程（创建分支——转换分支——在分支上进行开发——commit——push），尝试将python版本的全服广播模块push到分支
* 尝试接入Unity Cloud Diagnostics，并编写了相关文档

## 第三周（5.21 - 5.25）
* 学习gs语言（数据类型、条件语句等）
* 尝试移植广播功能模块到gs版本
* 学习了敏感词屏蔽算法（前缀树）
* 了解gs版本项目结构

## 第四周（5.28 - 6.1）
* 完成gs版本广播功能模块的移植
* 向gs版本增加离线收益报告功能
  * 离线收益报告：
    * 离线收益总体报告
    * 秘境挂机详细报告
  * 具体实现其实是游戏逻辑的判断
  * 玩家离线存在两种状态：修炼、秘境两种挂机状态
  * 玩家若是修炼挂机状态退出的游戏，在其退出十分钟后会调用服务器登出玩家的方法将其角色真正的登出（避免掉线情况的出现），修炼的挂机状态仅用记录下服务器登出玩家时间，后用玩家登陆时间-登出时间这段时间来计算离线收益即可
  * 秘境挂机状态则需要考虑秘境挂机最大时间为8小时，故在玩家角色的心跳方法中进行判断：
    * 角色是离线状态
    * 角色挂机时间是否超过八个钟
  * 若是超过了八个钟即转变玩家挂机状态（改为修炼挂机），同时调用服务器登出玩家操作同时记录下登出时间，待玩家上线后实际离线收益为秘境挂机收益加上修炼挂机收益
    * 秘境挂机收益即为玩家登出时间-玩家退出游戏时间的收益
    * 修炼挂机收益即为玩家登陆时间-玩家登出时间的收益
  * 具体实现过程为，在玩家登陆的时候在相应的登陆回调方法中进行状态的判断计算相应的离线收益（离线超过十分钟（此时才有登出时间的记录）才显示离线收益报告），服务器登出玩家的时候进行报告数据的清零，报告数据的记录即在相应的操作下进行数据库的写入。

## 第五周（6.4 - 6.6）
* 修复一些提示相关的小问题
  *  涉及到了命令的处理
  *  项目中存在三个终端：客户端、主服务器、辅助服务器
  *  主服务器负责处理游戏的主要逻辑
  *  辅助服务器则是处理玩家社交、全服广播等功能
  *  主服务器上有一个MsgHandler管理器负责对命令的处理
  *  先将编写好的方法绑定到相应的命令上，再将命令集保存在handlers的一个map中，后对map中的命令进行注册，当服务器收到来自客户端或者辅助服务器的请求的时候就会调用相应的方法
* 移植GM功能模块
  * 其中有一个GM功能是定时关机
  * 在这里面服务器关机方法是一个同步的方法，因为关机的过程不同的模块之间存在依赖，便直接把先后顺序写在这个方法中
  * 同样的为了避免误操作，服务器关机方法有一个cookie进行是否执行方法的的验证
  * 调用服务器关机方法需要新开一个协程，在协程中进行服务器关机，因为服务器关机中会将服务器正在关机的标志位置为true，而为了确保关机的flag在各个协程中一致，便简单的进行了协程休眠0.1秒的处理

## 第六周（6.11 - 6.15）
* 负责python版本版号申请的相关修改
  * 文本修改 —— BOSS->首领
  * 增加PVP警告
    * 具体实现方法是玩家角色到达15级时将"show_pvp_warning"的标志位为true，然后玩家在进入秘境的时候会向数据库读这一标志位的值，如果是true就显示PVP警告，当玩家点击接受按钮后客户端向服务端发接受信息并将"show_pvp_warning"置为false
  * 商店页面增加充值按钮
  * 隐藏帮助按钮等等

* 负责回归测试相关问题的修复
  * 登录界面玩家停留超过一定时间就自动断开连接
    * 实际上是创建了ws后ws超过了一段时间没有对象绑定它就进行销毁操作，修改超时时间即可
  * 排行榜页面显示战力和查看玩家信息里页面的战力不一致
    * 由于排行榜信息是存于redis中的，redis相当于缓存，每隔60s进行数据的保存，故会存在战力不一致的情况
  * 人物战力 = 装备附加战力 + 技能附加战力 + 自身气血 + 自身真元的修复
    * 其中后两项的战力策划要求当玩家进入人物属性界面的时候进行一次战力的刷新
    * 解决方案是当客户端玩家点击了人物属性界面按钮时同时向服务端发送刷新战力的请求，服务器返回刷新后的战力

## 第七周（6.17 - 6.20）
* 跑通压力测试并出性能报告
  * 测试在500人/1000人/2000人/5000人的情况下,内存/CPU/延迟等数据的情况
    * 完善了压测客户端的代码逻辑，在py版本下内存/cpu的获取是通过python的psutil库来获取的，在gs中暂时没有实现这一功能，故编写了一个外部的py程序来获取
    * 由于服务器端是gs版本而压测客户端是py语言写的，故如果要测试延迟的话，单纯的服务器->客户端或者客户端->服务端是行不通的，因为底层获取毫秒级时间的实现有所差异
    * 解决方法是 服务器->客户端->服务器 取这段时间除以2
  * 希望测试机器人可以配置为指定等级的标准人（有装备、技能） 
  * 希望可以配置机器人在不同秘境的分布情况

## 第八周（6.24 - 6.29）
* 换线表现问题
  * 选择线路后，combobox没有改变
    * 实际原因是点击线路后向服务器发送请求，服务器收到请求执行的指令的为玩家分配一条最优线路，故线路没有改变，修改下代码逻辑即可

* 增加怪物脱战回血机制和属性调节
  * 增加怪物脱战回血机制
    * 需求是脱离战斗后每秒回复2%的血量（在calc表中配置）
    * 初步思路是将脱战回血写在心跳中，当怪物是脱战状态且残血就进行自动回复
    * 但原本心跳的逻辑是周围没有玩家，怪物就停止心跳，这与上面逻辑产生冲突
    * 故改为当周围没有玩家且满状态时才停止心跳，脱战回血至满状态停止心跳
  * 支持单独配置某一怪物的属性比例
  * 支持快速调节秘境怪物难度

* 离线相关调整
  * 离线状态保存
    * 当玩家切出游戏小于等于60s，保留玩家之前操作的界面
    * 当玩家切出游戏大于60s，进行重新连接
    * 产生这一需求的原因是，当玩家切出游戏的时候，客户端判断玩家切出就执行断线操作，故玩家切回来游戏会重新连接，界面也重置到主界面
    * 解决方案为加入标志位和定时器
  * 离线状态保存后续
    * 采用上面的方法实现离线状态保存后，在UNITY编辑器中测试功能正常，到模拟器上测试后就功能失效了
    * 应该是游戏切出后定时器就不会再工作了，也就不会自动重连了
    * 第二个解决方案即断开连接操作在服务器端进行
    * 原本打算继续采用信号（标志位）传递的方式来实现自动开关机，后发现仍是那个问题，当游戏切出后服务器向客户端发送的消息，客户端收不到
    * 最终的解决方法是当客户端切出时，记录时间并向服务器发送，服务器设置定时器和标志位来决定60s后要不要断开连接，当客户端切回来会向服务器发送“我已回来”类似的信号

* 统一游戏内所有系统的重置时间至上午八点
  * 每次刷新商店物品记录时间，当记录的时间与当前时间不在同一天 或者 记录的时间的小时小于8（这是保证已经是下一个刷新周期了），就继续判断当前时间的小时有没有超过8小时，就执行相应的重置操作

* 优化秘境怪物生成逻辑
  * 玩家主动点击地图/掉落物/怪物进行移动/拾取/攻击时，在未完成点击指令前不应自动反击或被其他目标吸引
    * 主要问题是战斗对象的心跳是按自动战斗状态处理的，因为战斗对象不仅有玩家，还包含了怪物，而怪物只有自动战斗状态，故玩家角色时刻都处于自动战斗状态
    * 解决方法就是若是手动状态就不执行自动战斗逻辑
      * gs中的.?方法调用，如果对象中有这个方法就调用，若是没有就返回void
  * 地图掉落物物品无法手动点击选取
    * 采集物不同于其他战斗对象，需要拎出来单独处理
  * 部分生成的怪物会原地不动
    * 之前的脱战回血的bug，怪物复活后没有进行状态的重置（其实进行了不过是在怪物死亡的时候，但是好像无效，不知道为什么）
  * 部分生成的怪物会突然消失
    * 怪物消失有两种情况
    * 一是怪物超时自动死亡（已修复）
      * 超时死亡的条件加入了若是旁边没有玩家才能执行的条件
    * 二是战斗对象视野问题
      * 会出现怪物突然消失，靠近后有再次出现的BUG 

* 机器人优化
  * 机器人设置标准人加入自动装备功能

* 战斗timer优化
  * 原先战斗中有timer.create实现技能前摇逻辑，在人数较多的情况下，会导致timer数量大量堆积，处理不过来
  * 可以尝试改为每个room维护一个延迟队列（时间槽）统一处理房间中的延迟事件，创建一个coroutine,每次sleep 0.1秒做循环刷新
  * 房间中维护一个类似心跳的时间槽，一个槽对应0.1秒，需要延迟处理的function放到对应槽中,槽的结构类似一个循环队列
  * 如果最多支持5秒的延迟队列,可以维护一个20s的时间槽队列,留有冗余，防止cpu占用多的时候还未处理就被反超一圈
  * 同时每次更新的时候根据上一次处理到的槽位和当前的槽位来决定要处理多少个槽，在卡的时候需要一次处理多个槽

## 第九周（7.1 - 7.6）
* 修复秘境相关BUG
  * 玩家自身底板改为透明
  * 手动战斗状态中角色不会自动移动
    * 控制角色行为的逻辑主要在心跳中，在心跳中加入限制条件判断玩家状态即可
  * 修复进入单人秘境报错
    * 进入秘境之后会创建一个combat_user对象，combat_user对象专门处理战斗事件的
  * 修复刚复活怪物的碰撞
    * 因为服务端复活单位没有向客户端同步属性(hp、mp)
  * 修复添加服务器端机器人报错
  * 修复普通攻击角色没有移动的BUG
  
* 神通系统逻辑修改
  * 修改神通遗忘学习逻辑
    * 现在不限制技能学习数量，但同时装备的技能最多为6个
      * 重新创建一张新表"learned_skills"存放已学习技能，原先的表"skills"作为已装备技能
      * 在此基础上进行神通系统逻辑修改

* 增加大境界衰减系数
  * 人物境界超过释放技能的技能，技能效果会有衰减
    * 需要注意的是，仅对神通技能有效，对怪物、人物技能与装备附带技能无效
    * 注意护盾类技能与伤害类技能数值计算是区别开的

* 支持秘境刷怪和刷洞府功能
  * 刷怪小工具
    * 将刷新点保存在文件上方便策划配置

## 第十周（7.8 - 7.11）
* 完善神通系统前端
  * 神通列表界面
  * 神通界面
  * 神通装配界面
  * 技能学习界面
* 前端界面之间的交互，注意好UI的事件和分辨率的适配就好了
* 发现了一个新的问题，由于后端一开始设计skills表和learned_skills是关联的，一个技能有变动另一张表中也会有变动，这样仅对learned_skills表进行操作即可
* 这时如果客户端重启，两表（指保存在客户端中的表）之间的关联就消失了，变成了“深拷贝”，故重启后需要重新对两张表进行同步
  * 最终的解决方法是在有技能操作的时候，对skills进行重新赋值
* 同样的如果服务器端重启，两表（指保存在服务器端的表）关联也不存在，也需要进行两表的重新同步

* 商城相关修改
  * 刷新逻辑调整
    * 根据玩家当前最大修炼等级决定各种类物品数量
    * 加入等级权重数值
    * 仙阁中class_id相同的物品最多只出现一个
  * 其他调整
    * 坊市中出售的丹方如果尚未解锁且包裹中无此丹方的时候,icon右上角有提示
    * 替换坊市购买按钮、物品栏、物品栏(点击)美术资源
    * 仙阁修改为坊市的竖状排版 

## 第十一周（7.15 - 7.20）
* 完善神通系统前端
  * 应策划和美术要求重新更改神通系统相关图片技能和UI特效等
  * 遇到了技能栏点击的相关问题
  * 技能栏分为已装备技能、可装备技能、未解锁三种状态
  * 其中已装备技能选中后技能栏外围有一层光圈
  * 这里使用了UGUI中的transition.SpritSwap的方法，但会导致一个问题，由于技能栏是一个prefab，同样的点击可装备技能或者未解锁技能栏也会出现同样的效果，显得很突兀
  * 原本解决方案是使用代码动态更改transition状态，但是项目前端开发使用的是lua语言，中间构件是Tolua，使用Tolua向transition赋值UnityEngine.UI.Selectable.Transition.ColorTint会报没有Transition错误（实际上官网API上也没有Transition这个枚举类，给的样例是C#语言的代码）
  * 最后曲线救国，在skills界面创建的时候先生成一个带有ColorTint的prefab和一个带有SpritSwap的prefab并保存下来后销毁掉这两个prefab，后对需要改变transition的object进行赋值就可以了

* 神通系统相关bug修复
  * 有两个槽位，其中一个已使用技能，另外一个装上时，会使已使用技能卸下
    * 判断已装备技能数量未把法宝技能剔除
  * 选择装配神通时，点击升级按钮，然后再点击使用，提示“装备技能失败”
    * 服务器端技能已装备，而客户端技能未装备
    * 不能百分百复现，仅发现一个出现同样情况的BUG
    * 在秘境战斗状态下，玩家升级的时候等级数据会偶尔出现没有更新到客户端的情况，这时客户端若是进行了学习技能操作，此时服务器端学习技能通过，客户端由于等级还没更新，用了旧的等级去get_unlocked_skill_num()故技能槽不足不让学习
    * 因为存在post操作设置角色等级的操作有可能比学习技能的操作晚就会出现这种情况

* 玩家体验优化
  * 增加了战斗包裹领取物品指引
  * 论道试炼任务超过自己3个小境界以上不能挑战

* 数据埋点相关
  * 修复并测试了数据埋点大多数功能
  * 修复商品出售已学习配方仍有小红点的BUG
  * 修复世界BOSS不会攻击的BUG
    * 世界BOSS生成的时候没有加入技能

* 刷新时间相关
  * 坊市进货次数达到上限显示倒计时
  * 运气次数达到上限显示倒计时
    * 当当前次数大于等于上限次数的时候设置一个next字段，存储刷新时间，并下发到客户端
    * 同时客户端相对应的界面存在一个类似计时器的东西，每隔一段时间就在重绘界面，重绘方法中会不断地查询角色是否有这个next字段的值
    * 若是有的话就显示倒计时
    * 当达到刷新时间的时候，服务器端就delete该字段，客户端也就同步的出现原先的按钮控件
    * 注意，重启服务器的时候如果没有做相应的逻辑判断，会出现服务器端没有delete该字段，客户端就显示了负数的倒计时

## 第十二周（7.22 - 7.26）
* 刷新倒计时
  * 加入了服药次数的刷新倒计时
  * 稍微修改一下倒计时按钮的UI效果

* 数据埋点及一些小问题
  * 数据埋点增加了新的统计项
  * 现在炼体玩家可以接取完整的论道试炼任务，且等级未满足最低要求不显示小红点

* 数据埋点（玩家表部分）及一些BUG的修复
  * 数据埋点玩家表功能完成
    * 在玩家存储数据中增加了一项statistics字段，数据类型为map的数据
    * 在需要记录的数据发生改变的方法中加入记录值并更新到statistics字段中
  * 修复了退出游戏后服药次数刷新的问题
    * 一开始以为是持久化的原因，后发现是加载玩家方法中设置了服药次数为0的命令...
    * 修复并完善了商店和服药刷新的问题
      * 每天上午与8点刷新，判断条件为 (触发时间跟现在时间不是同一天 || 触发时间的小时在早上8点之后) || 现在时间 - 出发时间 >= 24*60*60) 
  * 修复城市页面报错BUG

* 数据埋点货币相关
  * 灵石获取和消耗
  * 仙玉获取和消耗
    * 具体做法是在更改物品数量的底层方法中进行记录写入mongodb，后调用read_logs方法读取对应记录

* 修复服药倒计时不重置的BUG
  * 服务器重启导致的bug

* 数据埋点（宗门表）及一些BUG的修复
  * 宗门表相关的统计项
  * 修复了秘境中点击普通攻击详情界面的报错
  * 修复了击破宗门的玩家没有宗门不能统计的bug

* 数据埋点（洞府表）
  * 记录洞府点坐标、占领次数、被攻打次数等等

* 数据埋点的完善及测试
  * 顺便修复了重启服务器玩家没有法宝技能的bug

* 帮助文本相关
  * 加入了统一的帮助文本，帮助文本信息可以在helper_text.xlsx中配置

## 第十三周（7.29 - 8.2）
* 数据埋点功能优化
  * 现在玩家表从mongodb中取数据只取需要的部分
    * 之前读取指定字段的代码有问题，返回为空
    * 原因是mongoc中读取指定字段的数据的参数key值要为"projection"

* 数据埋点功能分批读取
  * 捞回被切片的数据

* 帮助文本前端完善
  * 按钮位置调整，透明度修改
  * 准备渡劫界面新增tip
  * 配置表支持换行和空格
    * 进行了文本的替换
  * 数据埋点留存率保留小数点后两位

* 战力系数处理
  * 装备和技能不进行战力系数处理

* 秘境大阵BUG修复及吐纳按钮alpha值修改
  * 不能在秘境大阵中进入秘境大阵
  * 吐纳按钮控件类是etcbutton
    * 修改其下的image.a无效
    * 最后解决方法是通过修改颜色#C8C8C880 最后两位表示0-255的alpha值

* 神通红点修复
  * 神通未达到学习等级时不显示红点
  * 神通学习界面标题修复

* 秘境大阵报错相关
  * 修复在福地地图挑战秘境大阵报错
  * 修复在论剑台挑战秘境大阵报错

* 数据埋点导出工具
  * 之前的数据埋点工具是内置在服务器gm功能中的
  * 数据埋点导出需要读取数据库大量的数据，易造成内存过大从而系统kill掉服务器进程
  * 故重新用py写了一个外部的导出工具

## 第十四周（8.5 - 8.10）
* 数据埋点聚灵阵、货币数据修正
  * 记录聚灵阵等级不小心用了累加的方式
  * 灵石数据加了两次，原因是从怪物掉落后进入战斗包裹算一次，从战斗包裹到个人包裹又计算了一次

* 一些bugly上的报错
  * 修复炼丹概率报错
  * 尝试修复对话报错、任务完成报错

* 增加眩晕和眩晕抗性属性
  * std_level_cal表和std_monster_calc表增加眩晕和眩晕抗性字段
  * monster表attrib字段支持配置眩晕及眩晕抗性字段百分比

* 修复客户端法宝伤害上限和护盾上限数值错误的问题

* 离线收益时间调整

* 修复数据埋点导出工具
  * 因为增加了新的宗门日志，格式与之前的不一致导致的

* 尝试修复connection问题
  * 存在ws但是ws上没有绑定玩家，不清楚该玩家是怎么做到的
  * 尝试进行了修复
    * ws存在但没有user不发送ping包，持续一段是时间超时后会自动重连
    * ws存在但没有user进行操作发送请求，直接弹出登录异常的提示框，并重启游戏

* 突破/渡劫惩罚修复
  * 渡劫失败沿用上次突破惩罚

* 支持数据埋点工具根据日期导出玩家信息
  * 但仅对货币等动态数据有效，对玩家的基础属性还是全局的

* 修复秘境大阵会出现传送门的BUG
  * 原因是进行了两次同步的操作，一次是战斗对象（与基础的玩家对象分离）的同步，一次是视野的同步，
  * 当断线重连的时候两次同步都有进行，故会创造两个传送门，但离开秘境的时候仅销毁一个传送门，这样就会有个传送门仍在原来坐标位置上

* 单人秘境增加倒计时
  * 单人秘境到达3分钟的时候会提出玩家，且弹出战斗失败的报告
  * 现在剩余时间还剩下30s的时候会显示倒计时

* 修复武痴NPC点击没有反应的问题
  * 在任务秘境中重连后，会在user_login_ok()下的user.send_user_data()中把任务数据发送到客户端，客户端读到任务数据，显示相对应的npc，但其实该npc任务已完成，就会出现上面那种情况
  * 如果没有重连操作的话，user的tasks字段中的重复任务也是不会删除的，而是仅把客户端中的npc删掉。
  * 至于为什么这个问题不是普遍发生的，是因为现在接取任务好像是客户端单方面的处理，城镇中到达特定时间刷出任务npc，但实际上服务器上人物的tasks字段是没有任务增加的，但是用GM工具接取任务的话task字段就会增加。

## 第十五周（8.12 - 8.17）
* 洞府虚影移动距离调整
  * 原来的代码中是有对虚影移动距离的限制的
  * 但是那是做在自动移动当中的，而虚影理论上一出来应该就进入了战斗状态（与攻打洞府的玩家战斗）
  * 而自动战斗逻辑中没有对移动距离限制，故玩家可以将虚影拉出大阵范围再进行击杀
  * 故在虚影的心跳中，在自动战斗逻辑上增加一层对移动距离的判断，若是超出就进入脱战状态，后自动销毁

* 修复商店报错
  * 商店报错原因是商店在刷新的时候客户端没有实时刷新，然后该玩家购买了未刷新的商店物品，但服务器找不到这件物品，就发生了数组越界的报错
  * review商店的客户端代码，发现是刷新函数没有写到co当中，导致代码尝试去sleep主线程，最后刷新失败

* 一键领取邮件附件功能
  * 遍历邮件列表，有附件且为领取的依次进行领取附件操作，并将其相应的tag标志为1

* 邮件奖励功能
  * 增加一键领取功能
  * 储物空间不足，奖励通过邮件发送
  * 尝试修复邮件窗口初始位置未置顶的问题

* 简单优化了客户端启动脚本
  * 方案：将多个lua脚本文件打包成一个zip包，后一次性载入到内存中，再从内存中读取数据，以此达到加速的效果
  * 通过减少EndofFrame()调用也达到了加速的效果，牺牲是加载进度条看起来没之前那么顺畅

* 数据埋点导出工具优化
  * 玩家表走分批处理逻辑，之前是一次性读取现在数据量大了会撑爆内存

* 数据埋点工具
  * 增加分批读取结束标志，避免一直在读取的情况

* 部分日志进行了重复记录，先mark一下

## 第十六周（8.19 - 8.24）

* 修复离线收益报告时间异常

* 修复同名control问题（任务奖励显示999炼体丹）

* 玩家反馈相关
  * 离线收益报告不加入分身得到的收益
  * 论剑台中禁止使用丹药
  * 修复物品不能堆叠的bug
  * 排行榜排名优化，当境界等级相同时，修为高的玩家排名靠前

* 修复使用物品乱序的问题

* 修复邮箱置顶问题

* 神通释放顺序移植神通界面

* 玩家反映问题修复
  * 修复法宝词缀数量显示不全
    * 显示高度不足，被隐藏了
  * 图纸详情界面固定显示为1-5条随机词条
  * 支持护盾抵扣比例配置
    * 从0.9降低至0.8，且支持在cal表中配置
  * 提交任务物品若无品质要求，任意品质物品均可以提交任务

* 修复炼丹BUG
  * 在物品可以堆叠的且包裹满的情况下，玩家可以通过堆叠的bug进行特定品质丹药的产出

* 数据埋点增加了导出单个玩家日志功能

* 宗门大阵相关
  * 修复宗门临时护盾未重置的BUG
  * 宗门大阵日志伤害改为大数表示

* 宗门技能逻辑调整
  * 护宗雷光伤害 = 目标百分比血量 + 宗门等级相关绝对值
    * 目标百分比血量在skiill表dbase下 percentage_damage 配置
    * 可参考护宗雷光技能
  * 增加宗门受击上限
    * 在level_gang表 gang_shield_damage_limit 下配置
  * 临时护盾保护时间调整

* 攻击宗门大阵达到伤害上限的前端提示

## 第十七周（8.26 - 8.31）

* 商店刷新及邮件相关
  * 修复商店刷新圆满神通残篇的bug
  * 修复邮箱置顶问题
    * 因为邮件系统是连接的辅助服务器，需要抛到协程去请求邮件
    * 直接给该控件赋值会出现，item还没创建的情况，故代码失效
    * 现在是创建一个timer，等待0.3秒后再让其置顶

* 玩家没有名字或者头像走重新起名流程

* 修复导出单个玩家数据时玩家名含有特殊符号的报错

* 集成Unity Cloud Diagnosistic

* 修复因为关闭服务器导致清除宗门保护模式的timer销毁的问题

* 修复排行榜等玩家信息部分装备词缀显示不全的BUG

* 登陆界面加入用户报告按钮

* 秘境中显示玩家所属宗门，顺便修复秘境中不显示玩家称号的BUG
  * 战斗对象传入"gang" 、 "equip_title_id"字段数据

* 战斗优化，原先战斗逻辑会导致玩家在怪物里面对怪物进行自动攻击而不响应玩家的移动命令
  * 当玩家在移动的时候优先移动，而不是走自动战斗逻辑

* 优化用户报告，将用户报告放到外层

* 修为丹药改为单个使用

## 第十八周（9.2 - 9.7）

* 反馈问题处理
  * 使用御剑术后进入自动战斗模式，开始自动追击敌人
  * 新玩家默认以自身RID作为名字，取名后替换

* 统计工具优化
  * 新服数据剔除老玩家数据
  * 使用mongodb.aggregate方法编写pipeline筛选出老玩家的设备号
    * match操作中指定从account_login日志读取数据
    * group对日志中的玩家设备进行分组
  * 在新服进行数据统计的时候，先读入老玩家数据，使用map存起来加速读取，若判断是老玩家则跳过处理

* 新玩家默认进入日志频道

* 数据埋点工具优化
  * 兼容新版本日志格式
  * 导出玩家表一批次日志数改为100W条（mongodb中两亿条日志）
  * 导出逻辑改为先导出玩家基础数据表，灵石机缘等数据处理相关的放到后面的批次慢慢导出
  * 减少IO操作，改为每10个批次导出一份excel表，最后导出的表为完整表

* 渡劫和敏感词等优化
  * 当背包无渡劫道具，且玩家属性不足以成功渡劫，弹出渡劫警告提示框
  * 敏感词词库补充
    * 玩家取名需要通过敏感词检测
    * 宗门取名需要通过敏感词检测
  * BOSS显示优化
    * BOSS插画改为原先1.5倍，可在calc表中配置
  * 战斗统计报告初始位置改为最底层

* 预加载敏感词功能模块
  * 防止跑CICD的时候前缀树没有生成的情况

* 敏感词特殊符号屏蔽加入word的空白符，防止某些词无法屏蔽

* 修复群攻法宝只攻击一个目标的BUG
  * 选择已选择的目标，targets中存入了两个相同的object

## 第十九周（9.9 - 9.12）

* 增加导出流失玩家日志功能
  * 以开服时间为起点，输入时间为终点，期间未登录的玩家为流失玩家
  * 导出流失玩家最后20条日志详情及日志操作统计
  * 导出流失玩家数据excel表

* 支持pad的屏幕分辨率适配
  * 对长宽比低于1.7的设配进行屏幕缩放的方式，保持最佳长宽比16:9，两边留有黑边的方式
  * 方案1，通过更改canvas渲染模式和camera的视口大小达到黑边效果，但相应坐标有所偏移，故放弃之
  * 方案2，在Unity的C#层调用SetResolutioin方法设置分辨率，达到了屏幕拉伸的效果，不是期望的黑边效果，放弃
  * 方案3，通过更改androidmanifest文件达到黑边效果，类比全面屏的处理方式，设置最小长宽比，打包测试后无效，放弃

## 第二十周（9.16 - 9.19）

* 屏幕分辨率适配
  * 重新拾起方案1，对遇到的问题进行一一兼容
  * 秘境地图坐标偏移问题，之前渲染模式是overlay，现在改为camera，之前坐标采用position属性处理，改用localposition去除camera坐标的影响
  * 屏幕宽度相关也需进行相关处理，以及x轴上的偏移处理